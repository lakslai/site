<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI QUIZ PRO</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    <style>
        :root { --red: #e21b3c; --blue: #1368ce; --yellow: #d89e00; --green: #26890c; --dark: #46178f; --cyan: #00f2ff; }
        body { font-family: 'Montserrat', sans-serif; background: var(--dark); color: white; margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        .container { width: 100%; max-width: 600px; text-align: center; }
        
        /* –ë–ª–æ–∫ –ò–ò - —Ç–µ–ø–µ—Ä—å –±–æ–ª—å—à–æ–π –∏ –∫—Ä–∞—Å–∏–≤—ã–π */
        #ai-box { 
            background: rgba(0,0,0,0.7); border: 3px solid var(--cyan); padding: 25px; border-radius: 20px; 
            margin: 15px 0; font-family: 'Courier New', monospace; font-size: 18px; line-height: 1.6;
            text-align: left; min-height: 150px; box-shadow: 0 0 30px rgba(0, 242, 255, 0.2);
        }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px; }
        .answer-btn { border: none; height: 100px; border-radius: 20px; font-size: 20px; font-weight: 900; color: white; cursor: pointer; box-shadow: 0 6px 0 rgba(0,0,0,0.2); }
        .btn-0 { background: var(--red); } .btn-1 { background: var(--blue); }
        .btn-2 { background: var(--yellow); } .btn-3 { background: var(--green); }
        
        /* –°—á–µ—Ç –∫–æ–º–∞–Ω–¥—ã –≤ —É–≥–ª—É */
        #team-badge { background: var(--cyan); color: var(--dark); padding: 10px 20px; border-radius: 50px; font-weight: bold; margin-bottom: 10px; display: inline-block; }
        
        #timer-circle { font-size: 35px; font-weight: 900; background: white; color: var(--dark); width: 70px; height: 70px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 10px auto; border: 5px solid var(--cyan); }
        
        .hidden { display: none !important; }
        input, select { padding: 15px; width: 90%; border-radius: 12px; border: none; margin: 10px; font-size: 18px; }
        .leaderboard { background: white; color: black; border-radius: 20px; padding: 20px; }
        .score-row { display: flex; justify-content: space-between; padding: 10px; border-bottom: 2px solid #eee; font-size: 22px; font-weight: bold; }
        
        .admin-panel { background: #000; padding: 15px; border: 2px solid red; margin-top: 20px; border-radius: 20px; text-align: left; }
    </style>
</head>
<body>

<div class="container">
    <h1 id="main-title" onclick="secretClick()" style="cursor:pointer; text-shadow: 3px 3px 0px rgba(0,0,0,0.5);">AI BATTLE ü§ñ</h1>

    <div id="login-screen">
        <input type="text" id="username" placeholder="–¢–≤–æ–µ –ò–º—è...">
        <select id="userteam">
            <option>–ö–æ–º–∞–Ω–¥–∞ 1</option><option>–ö–æ–º–∞–Ω–¥–∞ 2</option>
            <option>–ö–æ–º–∞–Ω–¥–∞ 3</option><option>–ö–æ–º–∞–Ω–¥–∞ 4</option>
        </select>
        <button class="answer-btn btn-1" style="width: 100%; height: 60px;" onclick="join()">–í–°–¢–£–ü–ò–¢–¨ –í –ë–û–ô</button>
    </div>

    <div id="wait-screen" class="hidden">
        <div id="team-badge">–¢–≤–æ—è –∫–æ–º–∞–Ω–¥–∞: <span id="my-team-name">?</span> | –ë–∞–ª–ª—ã: <span id="my-team-score">0</span></div>
        <h2 id="wait-text">–û–∂–∏–¥–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã —É—á–∏—Ç–µ–ª—è...</h2>
    </div>

    <div id="game-screen" class="hidden">
        <div id="timer-circle">60</div>
        <h2 id="question-text">–í–æ–ø—Ä–æ—Å...</h2>
        <div id="ai-box"></div>
        <div id="answers-grid" class="grid">
            <button class="answer-btn btn-0" id="opt-0" onclick="sendAnswer(0)"></button>
            <button class="answer-btn btn-1" id="opt-1" onclick="sendAnswer(1)"></button>
            <button class="answer-btn btn-2" id="opt-2" onclick="sendAnswer(2)"></button>
            <button class="answer-btn btn-3" id="opt-3" onclick="sendAnswer(3)"></button>
        </div>
    </div>

    <div id="finish-screen" class="hidden">
        <h1>–ò–¢–û–ì–ò –£–†–û–ö–ê üèÜ</h1>
        <div id="leaderboard-data" class="leaderboard"></div>
        <button class="answer-btn btn-1" style="width:100%; margin-top:20px;" onclick="location.reload()">–ù–ê –ì–õ–ê–í–ù–£–Æ</button>
    </div>

    <div id="admin-area" class="admin-panel hidden">
        <h4>–ü—É–ª—å—Ç –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h4>
        <div id="q-buttons"></div>
        <button onclick="showFinal()" style="background: gold; padding: 10px; margin: 5px;">üèÜ –§–ò–ù–ê–õ</button>
        <button onclick="resetGame()" style="background: red; color: white; padding: 10px;">üß® –ü–û–õ–ù–´–ô –°–ë–†–û–°</button>
        <div id="admin-log" style="font-size: 11px; margin-top:10px; background: #111; padding: 5px;"></div>
    </div>
</div>

<script>
// === –¢–í–û–ô CONFIG FIREBASE ===
const firebaseConfig = {
  apiKey: "AIzaSyC9QIPxowR7HdMFCxi0bRJ_Z20lXQXr5K0",
  authDomain: "ai-school-quiz.firebaseapp.com",
  databaseURL: "https://ai-school-quiz-default-rtdb.firebaseio.com",
  projectId: "ai-school-quiz",
  storageBucket: "ai-school-quiz.firebasestorage.app",
  messagingSenderId: "155195208675",
  appId: "1:155195208675:web:21799fc642e88ddce826d6",
  measurementId: "G-Y4N2NGVNS9"
};
// ============================

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const questions = [
    { q: "–ß—Ç–æ —Ç–∞–∫–æ–µ –Ω–µ–π—Ä–æ—Å–µ—Ç—å?", opts: ["–ü—Ä–æ–≥—Ä–∞–º–º–∞", "–ñ–∏–≤–æ–π –º–æ–∑–≥", "–í–∏—Ä—É—Å", "–ß–∏–ø"], correct: 0, ai: "–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –Ω–µ–π—Ä–æ—Å–µ—Ç—å ‚Äî —ç—Ç–æ –æ—á–µ–Ω—å –ø—Ä–∏–ª–µ–∂–Ω—ã–π —É—á–µ–Ω–∏–∫. –û–Ω –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç –º–∏–ª–ª–∏–æ–Ω—ã –∫–∞—Ä—Ç–∏–Ω–æ–∫ —Å –∫–æ—Ç–∞–º–∏, –ø–æ–∫–∞ –Ω–µ –ø–æ–π–º–µ—Ç, —á—Ç–æ —É –∫–æ—Ç–∞ –µ—Å—Ç—å —É—à–∏ –∏ —Ö–≤–æ—Å—Ç. –≠—Ç–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞, –∫–æ—Ç–æ—Ä–∞—è —É—á–∏—Ç—Å—è –Ω–∞ —Å–≤–æ–∏—Ö –æ—à–∏–±–∫–∞—Ö, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∫–æ–¥." },
    { q: "–ö—Ç–æ —Ç–∞–∫–æ–π –ò–ª–æ–Ω –ú–∞—Å–∫ –≤ –º–∏—Ä–µ –ò–ò?", opts: ["–°–æ–∑–¥–∞—Ç–µ–ª—å", "–ò–Ω–≤–µ—Å—Ç–æ—Ä", "–•–∞–∫–µ—Ä", "–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫"], correct: 1, ai: "–ò–ª–æ–Ω –ú–∞—Å–∫ –±—ã–ª –æ–¥–Ω–∏–º –∏–∑ –æ—Å–Ω–æ–≤–∞—Ç–µ–ª–µ–π OpenAI, –Ω–æ –ø–æ–∑–∂–µ –ø–æ–∫–∏–Ω—É–ª –∫–æ–º–ø–∞–Ω–∏—é. –°–µ–π—á–∞—Å –æ–Ω —Ä–∞–∑–≤–∏–≤–∞–µ—Ç —Å–≤–æ–π –ò–ò –ø–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏–µ–º Grok, —Å—á–∏—Ç–∞—è, —á—Ç–æ –ò–ò –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–∞–≤–¥–∏–≤—ã–º." },
    { q: "–ú–æ–∂–µ—Ç –ª–∏ –ò–ò –Ω–∞–ø–∏—Å–∞—Ç—å –∫–æ–¥ –∑–∞ —Ç–µ–±—è?", opts: ["–ù–µ—Ç", "–¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏", "–î–∞, –ª–µ–≥–∫–æ", "–í 2090 –≥–æ–¥—É"], correct: 2, ai: "–£–∂–µ —Å–µ–≥–æ–¥–Ω—è –ò–ò (–∫–∞–∫ —è!) –ø–∏—à–µ—Ç —Ç—ã—Å—è—á–∏ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ –µ–∂–µ—Å–µ–∫—É–Ω–¥–Ω–æ. –û–Ω –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞–º —Ä–∞–±–æ—Ç–∞—Ç—å –±—ã—Å—Ç—Ä–µ–µ, –Ω–æ —á–µ–ª–æ–≤–µ–∫—É –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ª–æ–≥–∏–∫—É, —á—Ç–æ–±—ã –Ω–∏—á–µ–≥–æ –Ω–µ —Å–ª–æ–º–∞–ª–æ—Å—å." }
];

let myID = "";
let myTeam = "";
let clickCount = 0;

function secretClick() {
    clickCount++; if(clickCount >= 5) document.getElementById('admin-area').classList.toggle('hidden');
}

function join() {
    let name = document.getElementById('username').value;
    myTeam = document.getElementById('userteam').value;
    if(!name) return alert("–ò–º—è!");
    myID = name + "_" + Math.floor(Math.random()*100);
    document.getElementById('my-team-name').innerText = myTeam;
    document.getElementById('login-screen').classList.add('hidden');
    document.getElementById('wait-screen').classList.remove('hidden');
}

// –õ–û–ì–ò–ö–ê –ë–ê–õ–õ–û–í (10, 5, 1, 0)
async function sendAnswer(idx) {
    document.getElementById('game-screen').classList.add('hidden');
    document.getElementById('wait-screen').classList.remove('hidden');
    document.getElementById('wait-text').innerText = "–û—Ç–≤–µ—Ç –ø—Ä–∏–Ω—è—Ç! –ñ–¥–µ–º –ò–ò...";

    const taskSnap = await db.ref('currentTask').once('value');
    const correctIdx = taskSnap.val().correct;

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Ç–≤–µ—Ç–∏–ª–∞ –ª–∏ —É–∂–µ —Ç–≤–æ—è –∫–æ–º–∞–Ω–¥–∞ –≤ —ç—Ç–æ–º —Ä–∞—É–Ω–¥–µ
    const roundAnswers = await db.ref('roundAnswers').once('value');
    const hasTeamAnswered = Object.values(roundAnswers.val() || {}).some(a => a.team === myTeam);

    if (!hasTeamAnswered) {
        // –ï—Å–ª–∏ —Ç–≤–æ—è –∫–æ–º–∞–Ω–¥–∞ –ø–µ—Ä–≤–∞—è –∏–∑ –≤—Å–µ—Ö –æ—Ç–≤–µ—Ç–∏–≤—à–∏—Ö
        let currentOrder = Object.keys(roundAnswers.val() || {}).length; // –ö–∞–∫–æ–π –ø–æ —Å—á–µ—Ç—É –æ—Ç–≤–µ—Ç –≤ –º–∏—Ä–µ
        let points = 0;
        
        if (idx === correctIdx) {
            if (currentOrder === 0) points = 10;
            else if (currentOrder === 1) points = 5;
            else if (currentOrder === 2) points = 1;
        }

        // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –æ—Ç–≤–µ—Ç –≤ —Ä–∞—É–Ω–¥ (—á—Ç–æ–±—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É)
        db.ref('roundAnswers').push({ team: myTeam, correct: (idx === correctIdx) });

        // –î–æ–±–∞–≤–ª—è–µ–º –±–∞–ª–ª—ã –≤ –æ–±—â—É—é –∫–æ–ø–∏–ª–∫—É –∫–æ–º–∞–Ω–¥—ã
        if (points > 0) {
            const teamRef = db.ref('teamScores/' + myTeam);
            teamRef.transaction(current => (current || 0) + points);
        }
    }
}

// –£–ü–†–ê–í–õ–ï–ù–ò–ï –î–õ–Ø –¢–ï–ë–Ø
const qDiv = document.getElementById('q-buttons');
questions.forEach((q, i) => {
    let btn = document.createElement('button');
    btn.innerText = "–í–æ–ø—Ä–æ—Å " + (i+1);
    btn.onclick = () => {
        db.ref('roundAnswers').remove();
        db.ref('gameState').set({ status: "play", qId: i, startTime: Date.now() });
        db.ref('currentTask').set(q);
    };
    qDiv.appendChild(btn);
});

function showFinal() { db.ref('gameState').set({ status: "finish" }); }
function resetGame() { db.ref().remove(); location.reload(); }

// –°–õ–£–®–ê–ï–ú –ë–ê–ó–£
db.ref('gameState').on('value', snap => {
    const s = snap.val(); if(!s) return;
    if(s.status === "play") {
        const q = questions[s.qId];
        document.getElementById('wait-screen').classList.add('hidden');
        document.getElementById('game-screen').classList.remove('hidden');
        document.getElementById('question-text').innerText = q.q;
        q.opts.forEach((t, i) => document.getElementById('opt-'+i).innerText = t);
        typeAI(q.ai); startTimer(60);
    } else if(s.status === "finish") {
        document.getElementById('game-screen').classList.add('hidden');
        document.getElementById('wait-screen').classList.add('hidden');
        document.getElementById('finish-screen').classList.remove('hidden');
        updateLeaderboard();
    }
});

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤ –Ω–∞ —ç–∫—Ä–∞–Ω–µ —É—á–µ–Ω–∏–∫–∞
db.ref('teamScores').on('value', snap => {
    const scores = snap.val() || {};
    if(myTeam && scores[myTeam]) document.getElementById('my-team-score').innerText = scores[myTeam];
});

function typeAI(text) {
    let i = 0; let box = document.getElementById('ai-box'); box.innerText = "ü§ñ ";
    if(window.aiInt) clearInterval(window.aiInt);
    window.aiInt = setInterval(() => {
        box.innerText += text[i]; i++;
        if(i >= text.length) clearInterval(window.aiInt);
    }, 100); // –û–ß–ï–ù–¨ –º–µ–¥–ª–µ–Ω–Ω–æ –∏ –∫—Ä–∞—Å–∏–≤–æ
}

function startTimer(s) {
    let t = s; let el = document.getElementById('timer-circle');
    if(window.timerInt) clearInterval(window.timerInt);
    window.timerInt = setInterval(() => {
        t--; el.innerText = t;
        if(t <= 0) { clearInterval(window.timerInt); document.getElementById('game-screen').classList.add('hidden'); }
    }, 1000);
}

function updateLeaderboard() {
    db.ref('teamScores').once('value', snap => {
        const s = snap.val() || {};
        const board = document.getElementById('leaderboard-data');
        board.innerHTML = "";
        ["–ö–æ–º–∞–Ω–¥–∞ 1", "–ö–æ–º–∞–Ω–¥–∞ 2", "–ö–æ–º–∞–Ω–¥–∞ 3", "–ö–æ–º–∞–Ω–¥–∞ 4"].forEach(t => {
            board.innerHTML += `<div class="score-row"><span>${t}</span><span>${s[t] || 0}</span></div>`;
        });
    });
}
</script>
</body>
</html>
