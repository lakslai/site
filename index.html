<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI QUIZ FINAL</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    <style>
        :root { --red: #e21b3c; --blue: #1368ce; --yellow: #d89e00; --green: #26890c; --dark: #46178f; --cyan: #00f2ff; }
        body { font-family: 'Montserrat', sans-serif; background: var(--dark); color: white; margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; overflow-x: hidden; }
        .container { width: 100%; max-width: 600px; text-align: center; box-sizing: border-box; }
        
        /* –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ë–õ–û–ö –ò–ò */
        #ai-box { 
            background: rgba(0,0,0,0.7); 
            border: 3px solid var(--cyan); 
            padding: 20px; 
            border-radius: 20px; 
            margin: 15px 0; 
            font-family: 'Courier New', monospace; 
            font-size: 18px; 
            line-height: 1.6;
            text-align: left; 
            min-height: 160px; 
            box-shadow: 0 0 25px rgba(0, 242, 255, 0.3);
            /* –ú–∞–≥–∏—è –ø—Ä–æ—Ç–∏–≤ —Å–ª–∏–ø–∞–Ω–∏—è —Å–ª–æ–≤: */
            white-space: pre-wrap; 
            word-wrap: break-word;
            overflow-wrap: break-word;
            word-spacing: 2px;
        }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 15px; }
        .answer-btn { border: none; height: 90px; border-radius: 18px; font-size: 18px; font-weight: 900; color: white; cursor: pointer; }
        .btn-0 { background: var(--red); } .btn-1 { background: var(--blue); }
        .btn-2 { background: var(--yellow); } .btn-3 { background: var(--green); }
        
        #team-badge { background: var(--cyan); color: var(--dark); padding: 10px 20px; border-radius: 50px; font-weight: bold; margin-bottom: 10px; font-size: 14px; }
        #timer-circle { font-size: 32px; font-weight: 900; background: white; color: var(--dark); width: 70px; height: 70px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 10px auto; border: 4px solid var(--cyan); }
        
        .hidden { display: none !important; }
        input, select { padding: 15px; width: 90%; border-radius: 12px; border: none; margin: 10px; font-size: 18px; }
        .leaderboard { background: white; color: black; border-radius: 20px; padding: 20px; }
        .score-row { display: flex; justify-content: space-between; padding: 10px; border-bottom: 2px solid #eee; font-size: 20px; font-weight: bold; }
        
        .admin-panel { background: #000; padding: 20px; border: 3px solid red; margin-top: 10px; border-radius: 25px; text-align: left; width: 100%; box-sizing: border-box; }
        .admin-btn { background: #222; color: white; border: 1px solid #444; padding: 14px; margin: 5px; cursor: pointer; border-radius: 10px; width: 45%; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h1 id="main-title" onclick="secretClick()" style="cursor:pointer; user-select:none; text-shadow: 2px 2px 0px #000;">AI BATTLE ü§ñ</h1>

    <div id="login-screen">
        <input type="text" id="username" placeholder="–í–≤–µ–¥–∏ –ò–º—è...">
        <select id="userteam">
            <option>–ö–æ–º–∞–Ω–¥–∞ 1</option><option>–ö–æ–º–∞–Ω–¥–∞ 2</option>
            <option>–ö–æ–º–∞–Ω–¥–∞ 3</option><option>–ö–æ–º–∞–Ω–¥–∞ 4</option>
        </select>
        <button class="answer-btn btn-1" style="width: 100%; height: 60px;" onclick="join()">–í –ë–û–ô!</button>
    </div>

    <div id="wait-screen" class="hidden">
        <div id="team-badge">–ö–æ–º–∞–Ω–¥–∞: <span id="my-team-name">?</span> | –ë–∞–ª–ª—ã: <span id="my-team-score">0</span></div>
        <h2 id="wait-text">–ü—Ä–∏–≥–æ—Ç–æ–≤—å—Å—è...</h2>
        <p>–£—á–∏—Ç–µ–ª—å –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤–æ–ø—Ä–æ—Å</p>
    </div>

    <div id="game-ui-wrapper">
        <div id="game-screen" class="hidden">
            <div id="timer-circle">60</div>
            <h2 id="question-text" style="margin: 10px 0;">–ó–∞–≥—Ä—É–∑–∫–∞...</h2>
            <div id="ai-box"></div>
            <div id="answers-grid" class="grid">
                <button class="answer-btn btn-0" id="opt-0" onclick="sendAnswer(0)"></button>
                <button class="answer-btn btn-1" id="opt-1" onclick="sendAnswer(1)"></button>
                <button class="answer-btn btn-2" id="opt-2" onclick="sendAnswer(2)"></button>
                <button class="answer-btn btn-3" id="opt-3" onclick="sendAnswer(3)"></button>
            </div>
        </div>
    </div>

    <div id="finish-screen" class="hidden">
        <h1 style="color: gold;">–ü–û–ë–ï–î–ò–¢–ï–õ–ò üèÜ</h1>
        <div id="leaderboard-data" class="leaderboard"></div>
        <button class="answer-btn btn-1" style="width:100%; margin-top:20px;" onclick="location.reload()">–ù–û–í–ê–Ø –ò–ì–†–ê</button>
    </div>

    <div id="admin-area" class="admin-panel hidden">
        <h3 style="color: red; margin: 0;">–ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø</h3>
        <div id="q-buttons"></div>
        <div style="margin-top: 15px;">
            <button onclick="showFinal()" class="admin-btn" style="background: gold; color: black;">üèÜ –§–ò–ù–ê–õ</button>
            <button onclick="resetGame()" class="admin-btn" style="background: #cc0000;">üß® –°–ë–†–û–°</button>
        </div>
        <div id="admin-log" style="font-size: 11px; margin-top:15px; background: #111; padding: 10px; height: 160px; overflow-y: auto; border: 1px solid #333; line-height: 1.4;"></div>
    </div>
</div>

<script>
// === –ö–û–ù–§–ò–ì FIREBASE (–í—Å—Ç–∞–≤—å —Å–≤–æ–π!) ===
const firebaseConfig = {
  apiKey: "AIzaSyC9QIPxowR7HdMFCxi0bRJ_Z20lXQXr5K0",
  authDomain: "ai-school-quiz.firebaseapp.com",
  databaseURL: "https://ai-school-quiz-default-rtdb.firebaseio.com",
  projectId: "ai-school-quiz",
  storageBucket: "ai-school-quiz.firebasestorage.app",
  messagingSenderId: "155195208675",
  appId: "1:155195208675:web:21799fc642e88ddce826d6",
  measurementId: "G-Y4N2NGVNS9"
};
// =====================================

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const questions = [
    { q: "–ö–∞–∫ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç—Å—è –ò–ò?", opts: ["–ò–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è –ò–≥—Ä–∞", "–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç", "–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç", "–ò—Å—Ç–∏–Ω–Ω—ã–π –ò—Å—Ç–æ—á–Ω–∏–∫"], correct: 1, ai: "–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º–∞. –≠—Ç–æ —Å–∏—Å—Ç–µ–º–∞, —Å–ø–æ—Å–æ–±–Ω–∞—è –æ–±—É—á–∞—Ç—å—Å—è –Ω–∞ –¥–∞–Ω–Ω—ã—Ö, —É–∑–Ω–∞–≤–∞—Ç—å –ª–∏—Ü–∞, –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å —Ç–µ–∫—Å—Ç—ã –∏ –¥–∞–∂–µ —É–ø—Ä–∞–≤–ª—è—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–º –±–µ–∑ –≤–æ–¥–∏—Ç–µ–ª—è. –û–Ω –∏–º–∏—Ç–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –Ω–∞—à–µ–≥–æ –º–æ–∑–≥–∞." },
    { q: "–ú–æ–∂–µ—Ç –ª–∏ –ò–ò –æ—à–∏–±–∞—Ç—å—Å—è?", opts: ["–ù–∏–∫–æ–≥–¥–∞", "–ü–æ—Å—Ç–æ—è–Ω–Ω–æ", "–î–∞, —ç—Ç–æ –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–∏", "–¢–æ–ª—å–∫–æ –≤ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ"], correct: 2, ai: "–î–∞, —ç—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏—è–º–∏ –ò–ò. –ò–Ω–æ–≥–¥–∞ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ –ø—Ä–∏–¥—É–º—ã–≤–∞—é—Ç —Ñ–∞–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –ø–æ—ç—Ç–æ–º—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ—Ç –ò–ò –≤—Å–µ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä—è—Ç—å —á–µ–ª–æ–≤–µ–∫—É." },
    { q: "–ö—Ç–æ –æ—Ç–µ—Ü –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∏?", opts: ["–ë–∏–ª–ª –ì–µ–π—Ç—Å", "–°—Ç–∏–≤ –î–∂–æ–±—Å", "–ê–ª–∞–Ω –¢—å—é—Ä–∏–Ω–≥", "–ò–ª–æ–Ω –ú–∞—Å–∫"], correct: 2, ai: "–ê–ª–∞–Ω –¢—å—é—Ä–∏–Ω–≥ –ø—Ä–µ–¥–ª–æ–∂–∏–ª —Ç–µ—Å—Ç, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, –º–æ–∂–µ—Ç –ª–∏ –º–∞—à–∏–Ω–∞ –º—ã—Å–ª–∏—Ç—å. –ï—Å–ª–∏ —á–µ–ª–æ–≤–µ–∫ –≤ —Ä–∞–∑–≥–æ–≤–æ—Ä–µ –Ω–µ –ø–æ–π–º–µ—Ç, —á—Ç–æ –æ–±—â–∞–µ—Ç—Å—è —Å —Ä–æ–±–æ—Ç–æ–º ‚Äî –∑–Ω–∞—á–∏—Ç, –º–∞—à–∏–Ω–∞ –ø—Ä–æ—à–ª–∞ —Ç–µ—Å—Ç –¢—å—é—Ä–∏–Ω–≥–∞." }
];

let myID = ""; let myTeam = ""; let clickCount = 0; let isAdmin = false;

function secretClick() {
    clickCount++;
    if(clickCount >= 5) {
        isAdmin = true;
        document.getElementById('admin-area').classList.remove('hidden');
        document.getElementById('game-ui-wrapper').classList.add('hidden');
        document.getElementById('login-screen').classList.add('hidden');
        document.getElementById('wait-screen').classList.add('hidden');
    }
}

function join() {
    let name = document.getElementById('username').value;
    myTeam = document.getElementById('userteam').value;
    if(!name) return alert("–ò–º—è!");
    myID = name + "_" + Math.floor(Math.random()*100);
    document.getElementById('my-team-name').innerText = myTeam;
    document.getElementById('login-screen').classList.add('hidden');
    document.getElementById('wait-screen').classList.remove('hidden');
}

async function sendAnswer(idx) {
    document.getElementById('game-screen').classList.add('hidden');
    document.getElementById('wait-screen').classList.remove('hidden');

    const taskSnap = await db.ref('currentTask').once('value');
    const correctIdx = taskSnap.val().correct;
    const roundSnap = await db.ref('roundAnswers').once('value');
    const roundData = roundSnap.val() || {};
    const hasTeamAnswered = Object.values(roundData).some(a => a.team === myTeam);

    if (!hasTeamAnswered) {
        let order = Object.keys(roundData).length;
        let points = 0;
        if (idx === correctIdx) {
            if (order === 0) points = 10;
            else if (order === 1) points = 5;
            else if (order === 2) points = 1;
        }
        db.ref('roundAnswers').push({ team: myTeam, correct: (idx === correctIdx), points: points });
        if (points > 0) {
            db.ref('teamScores/' + myTeam).transaction(c => (c || 0) + points);
        }
    }
}

questions.forEach((q, i) => {
    let btn = document.createElement('button'); btn.className = "admin-btn"; btn.innerText = "–í–û–ü–†–û–° " + (i+1);
    btn.onclick = () => {
        db.ref('roundAnswers').remove();
        db.ref('gameState').set({ status: "play", qId: i });
        db.ref('currentTask').set(q);
    };
    document.getElementById('q-buttons').appendChild(btn);
});

function showFinal() { db.ref('gameState').set({ status: "finish" }); }
function resetGame() { if(confirm("–°–±—Ä–æ—Å–∏—Ç—å –∏–≥—Ä—É?")) { db.ref().remove(); location.reload(); } }

db.ref('gameState').on('value', snap => {
    const s = snap.val(); if(!s) return;
    if(s.status === "play") {
        const q = questions[s.qId];
        document.getElementById('wait-screen').classList.add('hidden');
        document.getElementById('finish-screen').classList.add('hidden');
        if(!isAdmin) document.getElementById('game-screen').classList.remove('hidden');
        document.getElementById('question-text').innerText = q.q;
        q.opts.forEach((t, i) => document.getElementById('opt-'+i).innerText = t);
        typeAI(q.ai); startTimer(60);
    } else if(s.status === "finish") {
        document.getElementById('game-screen').classList.add('hidden');
        document.getElementById('wait-screen').classList.add('hidden');
        document.getElementById('finish-screen').classList.remove('hidden');
        renderFinalScores();
    }
});

db.ref('teamScores').on('value', snap => {
    const s = snap.val() || {};
    if(myTeam && s[myTeam]) document.getElementById('my-team-score').innerText = s[myTeam];
});

function typeAI(text) {
    let i = 0; let box = document.getElementById('ai-box'); box.innerText = "ü§ñ ";
    if(window.aiInt) clearInterval(window.aiInt);
    window.aiInt = setInterval(() => {
        box.innerText += text[i]; i++;
        if(i >= text.length) clearInterval(window.aiInt);
    }, 130); // –û—á–µ–Ω—å –ø–ª–∞–≤–Ω–∞—è –ø–µ—á–∞—Ç—å
}

function startTimer(s) {
    let t = s; let el = document.getElementById('timer-circle');
    if(window.timerInt) clearInterval(window.timerInt);
    window.timerInt = setInterval(() => {
        t--; el.innerText = t;
        if(t <= 0) { clearInterval(window.timerInt); document.getElementById('game-screen').classList.add('hidden'); }
    }, 1000);
}

function renderFinalScores() {
    db.ref('teamScores').once('value', snap => {
        const s = snap.val() || {};
        const board = document.getElementById('leaderboard-data');
        board.innerHTML = "";
        const teams = ["–ö–æ–º–∞–Ω–¥–∞ 1", "–ö–æ–º–∞–Ω–¥–∞ 2", "–ö–æ–º–∞–Ω–¥–∞ 3", "–ö–æ–º–∞–Ω–¥–∞ 4"];
        teams.sort((a, b) => (s[b] || 0) - (s[a] || 0));
        teams.forEach((t, index) => {
            let icon = index === 0 ? "ü•á" : (index === 1 ? "ü•à" : (index === 2 ? "ü•â" : ""));
            board.innerHTML += `<div class="score-row"><span>${icon} ${t}</span><span>${s[t] || 0} –±–∞–ª–ª–æ–≤</span></div>`;
        });
    });
}

db.ref('roundAnswers').on('value', snap => {
    let log = document.getElementById('admin-log'); log.innerHTML = "<b>–õ–û–ì –†–ê–£–ù–î–ê:</b><br>";
    if(snap.val()) Object.values(snap.val()).forEach(a => {
        log.innerHTML += `${a.correct ? "‚úÖ" : "‚ùå"} ${a.team} (+${a.points || 0})<br>`;
    });
});
</script>
</body>
</html>
